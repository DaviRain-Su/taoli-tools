# æ­¢æŸé€»è¾‘ä¿®å¤æ€»ç»“

## é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šç½‘æ ¼äº¤æ˜“ç­–ç•¥å‡ºç°é”™è¯¯çš„æ­¢æŸè§¦å‘ï¼š

```
å½“å‰æ€»èµ„äº§: 5583.53, æ­¢æŸé˜ˆå€¼: 5880.00, æœ€å¤§å›æ’¤: 2.0%
ğŸš¨ è§¦å‘æ­¢æŸ: å·²æ­¢æŸ (Full Stop), åŸå› : æ€»èµ„äº§äºæŸè¶…è¿‡2.0%
```

ä½†å®é™…ä¸Šï¼š
- å½“å‰æ€»èµ„äº§: 5583.53
- åˆå§‹èµ„äº§åº”è¯¥çº¦ä¸º: 6000
- å®é™…äºæŸç‡: (6000 - 5583.53) / 6000 = 6.94%
- é…ç½®çš„æœ€å¤§å›æ’¤: 2%

## é—®é¢˜æ ¹æº

### åŸå§‹é”™è¯¯é€»è¾‘
```rust
let total_stop_threshold = grid_state.total_capital * (1.0 - grid_config.max_drawdown);
if current_total_value < total_stop_threshold {
    // è§¦å‘æ­¢æŸ
}
```

### é—®é¢˜åˆ†æ
1. **é…ç½®æ–‡ä»¶ä¸­çš„ `total_capital = 1000.0`**ï¼Œä½†å®é™…è¿è¡Œæ—¶çš„æ€»èµ„äº§æ˜¯ 6000 å·¦å³
2. **æ­¢æŸé˜ˆå€¼è®¡ç®—é”™è¯¯**: 1000 Ã— (1 - 0.02) = 980ï¼Œè€Œä¸æ˜¯åŸºäºå®é™…åˆå§‹èµ„äº§ 6000
3. **å®é™…åº”è¯¥çš„æ­¢æŸé˜ˆå€¼**: 6000 Ã— (1 - 0.02) = 5880
4. **å½“å‰æ€»èµ„äº§ 5583.53 < 5880**ï¼Œæ‰€ä»¥è§¦å‘äº†æ­¢æŸ

ä½†æ˜¯å®é™…äºæŸç‡æ˜¯ï¼š(6000 - 5583.53) / 6000 = 6.94%ï¼Œè¿œè¶…è¿‡ 2% çš„é™åˆ¶ï¼Œæ‰€ä»¥æ­¢æŸæ˜¯æ­£ç¡®çš„ï¼Œåªæ˜¯æ—¥å¿—ä¿¡æ¯è¯¯å¯¼äº†ç”¨æˆ·ã€‚

## ä¿®å¤æ–¹æ¡ˆ

### æ–°çš„æ­£ç¡®é€»è¾‘
```rust
// è®¡ç®—å®é™…äºæŸç‡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å›ºå®šé˜ˆå€¼
let actual_loss_rate = if grid_state.total_capital > 0.0 {
    (grid_state.total_capital - current_total_value) / grid_state.total_capital
} else {
    0.0
};

if actual_loss_rate > grid_config.max_drawdown {
    warn!(
        "ğŸš¨ è§¦å‘æ€»èµ„äº§æ­¢æŸ - å½“å‰æ€»èµ„äº§: {:.2}, åˆå§‹èµ„äº§: {:.2}, å®é™…äºæŸç‡: {:.2}%, æœ€å¤§å›æ’¤é™åˆ¶: {:.1}%",
        current_total_value,
        grid_state.total_capital,
        actual_loss_rate * 100.0,
        grid_config.max_drawdown * 100.0
    );
    // è§¦å‘æ­¢æŸ
}
```

### ä¿®å¤æ•ˆæœ
1. **å‡†ç¡®è®¡ç®—äºæŸç‡**: åŸºäºå®é™…åˆå§‹èµ„äº§å’Œå½“å‰èµ„äº§è®¡ç®—çœŸå®äºæŸç‡
2. **æ¸…æ™°çš„æ—¥å¿—ä¿¡æ¯**: æ˜¾ç¤ºåˆå§‹èµ„äº§ã€å½“å‰èµ„äº§ã€å®é™…äºæŸç‡å’Œé™åˆ¶
3. **æ­£ç¡®çš„æ­¢æŸåˆ¤æ–­**: åŸºäºç™¾åˆ†æ¯”è€Œä¸æ˜¯ç»å¯¹å€¼è¿›è¡Œåˆ¤æ–­

### ç¤ºä¾‹è¾“å‡ºï¼ˆä¿®å¤åï¼‰
```
ğŸš¨ è§¦å‘æ€»èµ„äº§æ­¢æŸ - å½“å‰æ€»èµ„äº§: 5583.53, åˆå§‹èµ„äº§: 6000.00, å®é™…äºæŸç‡: 6.94%, æœ€å¤§å›æ’¤é™åˆ¶: 2.0%
ğŸš¨ è§¦å‘æ­¢æŸ: å·²æ­¢æŸ (Full Stop), åŸå› : æ€»èµ„äº§äºæŸ6.94%ï¼Œè¶…è¿‡2.0%é™åˆ¶
```

## è‡ªé€‚åº”è®¢å•å­˜æ´»æ—¶é—´åŠŸèƒ½

åŒæ—¶å®ç°äº†è‡ªé€‚åº”è®¢å•å­˜æ´»æ—¶é—´åŠŸèƒ½ï¼š

### æ ¸å¿ƒç‰¹æ€§
1. **å¸‚åœºçŠ¶å†µé€‚åº”**: æ ¹æ®æ³¢åŠ¨ç‡ã€è¶‹åŠ¿ã€æµåŠ¨æ€§åŠ¨æ€è°ƒæ•´
2. **æ€§èƒ½é€‚åº”**: æ ¹æ®è®¢å•æˆåŠŸç‡ã€å¹³å‡æˆäº¤æ—¶é—´è°ƒæ•´
3. **æ™ºèƒ½è°ƒæ•´ç®—æ³•**: 
   - é«˜æ³¢åŠ¨å¸‚åœºï¼šç¼©çŸ­å­˜æ´»æ—¶é—´ï¼ˆæ›´é¢‘ç¹æ›´æ–°ï¼‰
   - ä½æ³¢åŠ¨å¸‚åœºï¼šå»¶é•¿å­˜æ´»æ—¶é—´ï¼ˆå‡å°‘ä¸å¿…è¦æ›´æ–°ï¼‰
   - æˆåŠŸç‡é«˜ï¼šé€‚å½“å»¶é•¿å­˜æ´»æ—¶é—´
   - æˆåŠŸç‡ä½ï¼šç¼©çŸ­å­˜æ´»æ—¶é—´ï¼Œæ›´ç§¯æè°ƒæ•´

### é…ç½®å‚æ•°
```rust
struct AdaptiveOrderConfig {
    base_max_age_minutes: f64,      // åŸºç¡€30åˆ†é’Ÿ
    min_age_minutes: f64,           // æœ€å°30ç§’
    max_age_minutes: f64,           // æœ€å¤§2å°æ—¶
    volatility_factor: f64,         // æ³¢åŠ¨ç‡å› å­
    trend_factor: f64,              // è¶‹åŠ¿å› å­
    success_rate_factor: f64,       // æˆåŠŸç‡å› å­
    // ... å…¶ä»–é…ç½®
}
```

### è‡ªé€‚åº”ç®—æ³•
```rust
fn calculate_adaptive_max_age(&mut self, market_analysis: &MarketAnalysis, grid_state: &GridState, current_success_rate: f64) -> f64 {
    // 1. åŸºç¡€æ—¶é—´è°ƒæ•´
    let mut adaptive_age = self.base_max_age_minutes;
    
    // 2. å¸‚åœºæ³¢åŠ¨ç‡è°ƒæ•´
    if market_analysis.volatility > 0.03 {
        adaptive_age *= 0.7; // é«˜æ³¢åŠ¨æ—¶ç¼©çŸ­70%
    } else if market_analysis.volatility < 0.01 {
        adaptive_age *= 1.3; // ä½æ³¢åŠ¨æ—¶å»¶é•¿30%
    }
    
    // 3. æˆåŠŸç‡è°ƒæ•´
    if current_success_rate > 0.8 {
        adaptive_age *= 1.2; // é«˜æˆåŠŸç‡æ—¶å»¶é•¿
    } else if current_success_rate < 0.5 {
        adaptive_age *= 0.8; // ä½æˆåŠŸç‡æ—¶ç¼©çŸ­
    }
    
    // 4. è¾¹ç•Œé™åˆ¶
    adaptive_age.max(self.min_age_minutes).min(self.max_age_minutes)
}
```

## æ€»ç»“

1. **ä¿®å¤äº†æ­¢æŸé€»è¾‘é”™è¯¯**: ç°åœ¨åŸºäºå®é™…äºæŸç‡è€Œä¸æ˜¯é”™è¯¯çš„é˜ˆå€¼è®¡ç®—
2. **æ”¹å–„äº†æ—¥å¿—ä¿¡æ¯**: æä¾›æ›´æ¸…æ™°ã€å‡†ç¡®çš„æ­¢æŸè§¦å‘ä¿¡æ¯
3. **å®ç°äº†è‡ªé€‚åº”è®¢å•ç®¡ç†**: æ ¹æ®å¸‚åœºçŠ¶å†µå’Œæ€§èƒ½åŠ¨æ€è°ƒæ•´è®¢å•å­˜æ´»æ—¶é—´
4. **ä¿æŒäº†åŸæœ‰åŠŸèƒ½**: æ‰€æœ‰å…¶ä»–åŠŸèƒ½ä¿æŒä¸å˜ï¼Œåªæ˜¯ä¿®å¤äº†é€»è¾‘é”™è¯¯

è¿™ä¸ªä¿®å¤ç¡®ä¿äº†æ­¢æŸåŠŸèƒ½çš„æ­£ç¡®æ€§å’Œç”¨æˆ·ä½“éªŒçš„æ”¹å–„ã€‚ 