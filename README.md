# 🚀 Taoli Tools - 智能网格交易策略

一个基于 Rust 开发的高性能、企业级网格交易策略工具，专为 Hyperliquid 交易所设计。

## 📋 目录

- [项目简介](#项目简介)
- [核心特性](#核心特性)
- [系统架构](#系统架构)
- [安装配置](#安装配置)
- [使用说明](#使用说明)
- [配置详解](#配置详解)
- [风险控制](#风险控制)
- [性能监控](#性能监控)
- [故障排除](#故障排除)
- [开发指南](#开发指南)
- [许可证](#许可证)

## 🎯 项目简介

Taoli Tools 是一个专业的量化交易工具，实现了智能网格交易策略。该项目采用 Rust 语言开发，具有高性能、低延迟、内存安全等特点，适用于专业交易者和量化投资机构。

### 主要优势

- **🔥 高性能**: Rust 原生性能，毫秒级响应
- **🛡️ 安全可靠**: 内存安全，无数据竞争
- **🧠 智能决策**: 基于市场分析的动态策略调整
- **📊 实时监控**: 完整的性能指标和风险控制
- **🔧 高度可配置**: 灵活的参数配置和策略定制

## ✨ 核心特性

### 🎯 智能网格策略

- **动态网格间距**: 根据市场波动率自动调整网格间距
- **资金智能分配**: 基于持仓比例的动态资金分配
- **市场状态检测**: 实时分析市场趋势和波动性
- **渐进式建仓**: 从全现金状态逐步建立持仓

### ⚡ 批处理优化器

- **自适应批次大小**: 根据执行时间自动优化批次大小
- **性能趋势分析**: 监控执行性能并动态调整
- **调整冷却机制**: 防止过度频繁的参数调整
- **滑动窗口记录**: 保持最近执行时间的历史记录

### 🛡️ 风险控制系统

- **多层止损机制**: 总资产止损、浮动止损、单笔止损、加速下跌止损
- **保证金监控**: 实时监控保证金率，防止强制平仓
- **市场异常检测**: 识别极端市场状况并暂停交易
- **连接管理**: 网络连接监控和自动重连机制

### 📊 性能监控

- **实时指标**: 胜率、利润率、最大回撤、夏普比率等
- **历史记录**: 完整的交易历史和性能记录
- **状态持久化**: 自动保存和恢复交易状态
- **详细日志**: 分级日志记录，便于调试和分析

## 🏗️ 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                    Taoli Tools 架构图                        │
├─────────────────────────────────────────────────────────────┤
│  用户接口层                                                   │
│  ├── 配置管理 (config.toml)                                  │
│  ├── 命令行接口                                              │
│  └── 日志输出                                                │
├─────────────────────────────────────────────────────────────┤
│  策略执行层                                                   │
│  ├── 网格策略引擎 (grid.rs)                                  │
│  ├── 批处理优化器                                            │
│  ├── 订单优先级管理                                          │
│  └── 市场分析模块                                            │
├─────────────────────────────────────────────────────────────┤
│  风险控制层                                                   │
│  ├── 止损管理                                                │
│  ├── 保证金监控                                              │
│  ├── 连接管理                                                │
│  └── 异常处理                                                │
├─────────────────────────────────────────────────────────────┤
│  数据持久化层                                                 │
│  ├── 状态保存/恢复                                           │
│  ├── 性能数据记录                                            │
│  ├── 交易历史存储                                            │
│  └── 参数备份                                                │
├─────────────────────────────────────────────────────────────┤
│  交易所接口层                                                 │
│  ├── Hyperliquid SDK                                        │
│  ├── WebSocket 连接                                         │
│  ├── REST API 调用                                          │
│  └── 订单管理                                                │
└─────────────────────────────────────────────────────────────┘
```

## 🔧 安装配置

### 系统要求

- **操作系统**: Linux, macOS, Windows
- **Rust 版本**: 1.70.0 或更高
- **内存**: 最少 512MB RAM
- **网络**: 稳定的互联网连接

### 安装步骤

1. **克隆项目**
```bash
git clone https://github.com/your-username/taoli-tools.git
cd taoli-tools
```

2. **安装 Rust**
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env
```

3. **编译项目**
```bash
cargo build --release
```

4. **配置文件**
```bash
cp config.toml.example config.toml
# 编辑配置文件，填入您的私钥和参数
```

### 配置私钥

在 `config.toml` 文件中配置您的 Hyperliquid 私钥：

```toml
[account]
private_key = "your_private_key_here"
real_account_address = "0x..."  # 可选，如果不填则使用私钥对应的地址
```

⚠️ **安全提醒**: 请妥善保管您的私钥，不要将其提交到版本控制系统中。

## 🚀 使用说明

### 基本使用

1. **启动网格交易**
```bash
cargo run --release
```

2. **查看帮助**
```bash
cargo run --release -- --help
```

3. **使用特定配置文件**
```bash
cargo run --release -- --config custom_config.toml
```

### 运行示例

```bash
# 启动 FARTCOIN 网格交易
cargo run --release

# 输出示例：
# [2025-05-27T10:00:00Z INFO] 🚀 资金管理型动态网格交易策略已启动
# [2025-05-27T10:00:01Z INFO] 📊 市场状态检测 - 状态: 正常, 风险等级: 1
# [2025-05-27T10:00:02Z INFO] 🟢 买单创建成功: ID=12345, 价格=1.4221, 数量=54.2
```

### 安全退出

使用 `Ctrl+C` 安全退出程序，系统会：
1. 取消所有活跃订单
2. 保存当前状态
3. 生成最终报告

## ⚙️ 配置详解

### 网格策略参数

```toml
[grid]
# 基础参数
trading_asset = "FARTCOIN"    # 交易资产
total_capital = 1000.0        # 总资金 (USDT)
grid_count = 8                # 网格数量
trade_amount = 80.0           # 每格交易金额

# 网格间距
min_grid_spacing = 0.0025     # 最小网格间距 (0.25%)
max_grid_spacing = 0.004      # 最大网格间距 (0.4%)

# 风险控制
max_drawdown = 0.02           # 最大回撤 (2%)
max_single_loss = 0.01        # 单笔最大亏损 (1%)
trailing_stop_ratio = 0.08    # 浮动止损比例 (8%)
```

### 高级配置

```toml
# 性能优化
max_orders_per_batch = 8      # 批量订单数量
order_batch_delay_ms = 150    # 批次延迟 (毫秒)
check_interval = 3            # 检查间隔 (秒)

# 精度设置
price_precision = 4           # 价格精度
quantity_precision = 1        # 数量精度

# 保证金管理
leverage = 3                  # 杠杆倍数
margin_safety_threshold = 1.0 # 保证金安全阈值
```

## 🛡️ 风险控制

### 止损机制

1. **总资产止损**: 当总资产低于初始资金的 98% 时触发
2. **浮动止损**: 从最高点回撤 8% 时触发
3. **单笔止损**: 单笔持仓亏损超过 1% 时触发
4. **加速下跌止损**: 短期内价格快速下跌时触发

### 保证金监控

- 实时监控保证金率
- 低于安全阈值时发出警告
- 极低时自动减仓或停止交易

### 市场异常处理

- 检测极端市场状况
- 高波动时采用保守策略
- 流动性不足时暂停交易

## 📊 性能监控

### 实时指标

- **胜率**: 盈利交易占比
- **利润率**: 总利润 / 初始资金
- **最大回撤**: 历史最大亏损幅度
- **夏普比率**: 风险调整后收益
- **资金使用率**: 已分配资金占比

### 历史记录

所有交易数据和性能指标都会保存到本地文件：

- `grid_state.json`: 网格状态
- `performance_data.json`: 性能数据
- `trading_history.json`: 交易历史
- `dynamic_grid_params.json`: 动态参数

### 状态报告

系统每分钟输出详细的状态报告：

```
===== 网格交易状态报告 =====
时间: 1735300800
交易对: FARTCOIN
当前价格: 1.4197
网格间距: 0.2500% - 0.4000%
初始资金: 1000.00
可用资金: 520.13
持仓数量: 337.8000
持仓均价: 1.4100
持仓比例: 47.99%
当前总资产: 1000.45
资产变化: +0.05%
已实现利润: 0.45
利润率: 0.05%
活跃买单数: 8
活跃卖单数: 0
浮动止损价: 1.2972
止损状态: 正常
历史交易数: 15
最大回撤: 0.12%
连接重试次数: 0
==============================
```

## 🔧 故障排除

### 常见问题

1. **编译错误**
```bash
# 更新 Rust 工具链
rustup update
cargo clean
cargo build --release
```

2. **网络连接问题**
```bash
# 检查网络连接
ping api.hyperliquid.xyz
# 检查防火墙设置
```

3. **私钥错误**
```
Error: 私钥解析失败
```
解决方案：确保私钥格式正确，不包含 "0x" 前缀

4. **保证金不足**
```
Error: 保证金率过低
```
解决方案：增加账户资金或降低杠杆倍数

### 日志分析

启用详细日志：
```bash
RUST_LOG=debug cargo run --release
```

日志级别：
- `ERROR`: 严重错误
- `WARN`: 警告信息
- `INFO`: 一般信息
- `DEBUG`: 调试信息

### 性能优化

1. **减少网络延迟**
   - 使用就近的服务器
   - 优化网络配置

2. **调整批次大小**
   - 根据网络状况调整 `max_orders_per_batch`
   - 适当增加 `order_batch_delay_ms`

3. **内存优化**
   - 定期清理历史数据
   - 调整 `history_length` 参数

## 👨‍💻 开发指南

### 项目结构

```
taoli-tools/
├── src/
│   ├── main.rs              # 程序入口
│   ├── config.rs            # 配置管理
│   └── strategies/
│       └── grid.rs          # 网格策略实现
├── config.toml              # 配置文件
├── Cargo.toml              # 项目依赖
└── README.md               # 项目说明
```

### 核心模块

1. **网格策略引擎** (`grid.rs`)
   - 动态网格创建
   - 订单管理
   - 风险控制

2. **批处理优化器**
   - 自适应批次大小
   - 性能监控
   - 参数调整

3. **市场分析模块**
   - 技术指标计算
   - 市场状态检测
   - 趋势分析

### 扩展开发

1. **添加新策略**
```rust
// 在 src/strategies/ 目录下创建新文件
pub async fn run_new_strategy(config: Config) -> Result<(), Error> {
    // 策略实现
}
```

2. **自定义指标**
```rust
fn calculate_custom_indicator(prices: &[f64]) -> f64 {
    // 指标计算逻辑
}
```

3. **风险控制扩展**
```rust
fn custom_risk_check(state: &GridState) -> RiskCheckResult {
    // 自定义风险检查
}
```

### 测试

```bash
# 运行单元测试
cargo test

# 运行集成测试
cargo test --test integration

# 性能测试
cargo bench
```

## 📈 性能基准

### 测试环境
- CPU: Intel i7-10700K
- RAM: 32GB DDR4
- 网络: 1Gbps 光纤

### 性能指标
- **订单创建延迟**: < 100ms (平均)
- **内存使用**: < 50MB (稳定运行)
- **CPU 使用率**: < 5% (正常负载)
- **网络带宽**: < 1MB/小时

## 🔒 安全说明

### 私钥安全
- 使用环境变量存储私钥
- 定期轮换 API 密钥
- 启用双因素认证

### 资金安全
- 设置合理的止损参数
- 定期监控账户状态
- 使用专用交易账户

### 网络安全
- 使用 HTTPS/WSS 连接
- 验证 SSL 证书
- 监控异常连接

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件。

## 🤝 贡献指南

欢迎贡献代码！请遵循以下步骤：

1. Fork 本项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建 Pull Request

## 📞 支持与联系

- **问题反馈**: [GitHub Issues](https://github.com/your-username/taoli-tools/issues)
- **功能建议**: [GitHub Discussions](https://github.com/your-username/taoli-tools/discussions)
- **邮件联系**: your-email@example.com

## ⚠️ 免责声明

本软件仅供教育和研究目的使用。使用本软件进行实际交易存在风险，可能导致资金损失。请在充分了解风险的情况下使用，作者不承担任何因使用本软件而产生的损失。

---

**🎯 开始您的智能交易之旅！**

如果您觉得这个项目有用，请给我们一个 ⭐ Star！ 